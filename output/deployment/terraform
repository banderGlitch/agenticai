provider "aws" {
  region = "us-west-2"
}

resource "aws_instance" "snake-game" {
  ami           = "ami-0c94855ba95c71c99"
  instance_type = "t2.micro"
  vpc_security_group_ids = [aws_security_group.snake-game.id]
  key_name               = "snake-game"

  provisioner "remote-exec" {
    connection {
      type        = "ssh"
      host        = self.public_ip
      user        = "ubuntu"
      private_key = file("~/.ssh/snake-game")
    }

    inline = [
      "sudo apt-get update",
      "sudo apt-get install -y docker.io",
      "sudo systemctl start docker",
      "sudo docker run -d -p 3000:3000 <docker-hub-username>/snake-game:latest"
    ]
  }
}

resource "aws_security_group" "snake-game" {
  name        = "snake-game"
  description = "Allow inbound traffic on port 3000"

  ingress {
    from_port   = 3000
    to_port     = 3000
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
}